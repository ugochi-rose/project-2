<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vue Weather App</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    .weather-icon {
      width: 10rem !important;
      height: 10rem !important;
    }
    body.gradient-bg {
    background: url('./gradient.png');
    background-size: cover;
    background-position: ce;
    min-height: 100vh;
    margin: 0;
    color: white; /* Optional: makes text readable on dark background */
    }
    .glow-text {
    font-size: 2rem;
    font-weight: bold;
    color: #ffffff;
    text-shadow: 0 0 5px #ffffff, 0 0 15px white, 0 0 25px white;
    }
    .form-control{
      box-shadow: none !important;
    }
    @media (max-width: 767.98px){
      .weather-name{
        font-size: 2rem;
      }
    }
    </style>
</head>
<body class="gradient-bg">
  <div class="container py-5 px-5">
    <div class="row">
      <div class="col-12 col-md-5 mx-auto text-center">
        <div id="app">
          <h4 class="mb-4 pt-4">Today's Weather</h4>

          <!-- Bootstrap input + button -->
          <div class="d-flex gap-2 mb-3">
            <input v-model="city" class="form-control form-control-lg" placeholder="Enter city" />
            <button @click="getWeather" class="btn btn-primary" style="width: 10rem;">Get Weather</button>
          </div>

          <!-- Weather Result -->
          <div v-if="weather && weather.main" >
            <h4 class="pt-4 weather-name">{{ weather.name }}</h4>
            <p v-if="localDate"> {{ localDate }}</p>
            <img :src="iconUrl" :alt="weather.weather[0].description" class="weather-icon" />
            <h3 class="glow-text">{{ weather.main.temp }}¬∞C</h3>
            <p class="text-capitalize">{{ weather.weather[0].description }}</p>
            
          </div>

          <!-- Error Handling -->
          <p v-if="error" class="text-danger">{{ error }}</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          city: '',
          weather: null,
          error: '',
          localDate: '',
          iconUrl: ''

          
        }
      },
      methods: {
        async getWeather() {
          this.weather = null;
          this.error = '';
          this.localDate = '';

          const apiKey = '1d2326eaff8dbe53a3d40f211be7cc0e';
          const timeApiKey = 'NN9DA7YHE3P9'; // üîÅ Replace with your TimeZoneDB key

          const url = `https://api.openweathermap.org/data/2.5/weather?q=${this.city}&appid=${apiKey}&units=metric`;

          try {
            const response = await fetch(url);
            const data = await response.json();

            if (response.ok) {
              this.weather = data;
              const iconCode = data.weather[0].icon;
              this.iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;


              // Get lat and lon for time API
              const { lat, lon } = data.coord;

              // Fetch local date/time from TimeZoneDB
              const timeUrl = `https://api.timezonedb.com/v2.1/get-time-zone?     
               key=${timeApiKey}&format=json&by=position&lat=${lat}&lng=${lon}`;

              const timeRes = await fetch(timeUrl);
              const timeData = await timeRes.json();

              if (timeRes.ok && timeData.formatted) {
                  const dateObj = new Date(timeData.formatted);
                  const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                  this.localDate = dateObj.toLocaleDateString(undefined, options);
                } else {
                  this.localDate = 'Unavailable';
                }


            } else {
              this.error = data.message || 'City not found';
            }
          } catch (err) {
            this.error = 'Unable to fetch weather. Check your connection.';
          }
        }
      }
    }).mount('#app');
  </script>
</body>
</html>
